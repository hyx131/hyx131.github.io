<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>The useEffect Hook</title>
      <link href="/2020/08/22/reading-useeffect/"/>
      <url>/2020/08/22/reading-useeffect/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Blogs under <em>‘Reading’</em> category mainly gives highlights/snippets of the topic post for my personal learning purposes (may also contain other learning notes on the side).<br>For this topic in full, you can visit the original post here:</p><blockquote><p><em>Title</em>: A Complete Guide to useEffect<br><em>Author</em>: <a href="http://iqkui.com/">Dan Abramov</a><br><em>Path</em>: <a href="http://iqkui.com/a-complete-guide-to-useeffect/">http://iqkui.com/a-complete-guide-to-useeffect/</a></p></blockquote></blockquote><p>&nbsp;  </p><h3 id="Rendering"><a href="#Rendering" class="headerlink" title="Rendering"></a>Rendering</h3><p>Each render has its own props &amp; state &amp; event handlers &amp; effect &amp; …everything.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// During first render</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Counter</span></span>() &#123;</span><br><span class="line">  const count = 0; // Returned by useState()</span><br><span class="line">  // ...</span><br><span class="line">  &lt;p&gt;You clicked &#123;count&#125; <span class="built_in">times</span>&lt;/p&gt;</span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// After a click, our <span class="keyword">function</span> is called again</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Counter</span></span>() &#123;</span><br><span class="line">  const count = 1; // Returned by useState()</span><br><span class="line">  // ...</span><br><span class="line">  &lt;p&gt;You clicked &#123;count&#125; <span class="built_in">times</span>&lt;/p&gt;</span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// After another click, our <span class="keyword">function</span> is called again</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Counter</span></span>() &#123;</span><br><span class="line">  const count = 2; // Returned by useState()</span><br><span class="line">  // ...</span><br><span class="line">  &lt;p&gt;You clicked &#123;count&#125; <span class="built_in">times</span>&lt;/p&gt;</span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>When update the state (<code>setCount</code>), React calls component again with a different value for <code>count</code> (which is a <em>constant</em> inside the function).<br>Each render = component gets called <em>again</em> with a <em>different</em> <code>count</code> value (which was set as a constant) for that particular render.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Counter</span></span>() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="function"><span class="title">handleAlertClick</span></span>() &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      alert(<span class="string">&#x27;You clicked on: &#x27;</span> + count);</span><br><span class="line">    &#125;, 3000);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked &#123;count&#125; <span class="built_in">times</span>&lt;/p&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span><br><span class="line">        Click me</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">      &lt;button onClick=&#123;handleAlertClick&#125;&gt;</span><br><span class="line">        Show alert</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// During first render</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Counter</span></span>() &#123;</span><br><span class="line">  // ...</span><br><span class="line">  <span class="keyword">function</span> <span class="function"><span class="title">handleAlertClick</span></span>() &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      alert(<span class="string">&#x27;You clicked on: &#x27;</span> + 0);</span><br><span class="line">    &#125;, 3000);</span><br><span class="line">  &#125;</span><br><span class="line">  // ...</span><br><span class="line">  &lt;button onClick=&#123;handleAlertClick&#125; /&gt; // The one with 0 inside</span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// After a click, our <span class="keyword">function</span> is called again</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Counter</span></span>() &#123;</span><br><span class="line">  // ...</span><br><span class="line">  <span class="keyword">function</span> <span class="function"><span class="title">handleAlertClick</span></span>() &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      alert(<span class="string">&#x27;You clicked on: &#x27;</span> + 1);</span><br><span class="line">    &#125;, 3000);</span><br><span class="line">  &#125;</span><br><span class="line">  // ...</span><br><span class="line">  &lt;button onClick=&#123;handleAlertClick&#125; /&gt; // The one with 1 inside</span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Above example: although the function is async, but the handler will still “see” the value at the time it is being called. Because inside each render, props and state and any values using them (including event handlers) “belongs” to that particular render, thus variables in their scope will only “see” the value for that particular component call.</p><h3 id="Effect-Cleanup"><a href="#Effect-Cleanup" class="headerlink" title="Effect Cleanup"></a>Effect Cleanup</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">// First render, props are &#123;id: 10&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Example</span></span>() &#123;</span><br><span class="line">  // ...</span><br><span class="line">  useEffect(</span><br><span class="line">    // Effect from first render</span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">      ChatAPI.subscribeToFriendStatus(10, handleStatusChange);</span><br><span class="line">      // Cleanup <span class="keyword">for</span> effect from first render</span><br><span class="line">      <span class="built_in">return</span> () =&gt; &#123;</span><br><span class="line">        ChatAPI.unsubscribeFromFriendStatus(10, handleStatusChange);</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Next render, props are &#123;id: 20&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Example</span></span>() &#123;</span><br><span class="line">  // ...</span><br><span class="line">  useEffect(</span><br><span class="line">    // Effect from second render</span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">      ChatAPI.subscribeToFriendStatus(20, handleStatusChange);</span><br><span class="line">      // Cleanup <span class="keyword">for</span> effect from second render</span><br><span class="line">      <span class="built_in">return</span> () =&gt; &#123;</span><br><span class="line">        ChatAPI.unsubscribeFromFriendStatus(20, handleStatusChange);</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Cleanup function is called before the next render, values it “sees” = values captured in current render.</p><h3 id="Synchronization"><a href="#Synchronization" class="headerlink" title="Synchronization"></a>Synchronization</h3><p>Not lifecycle. <em>React is about the destination, not journey</em>.<br>React synchronizes DOM according to current state &amp; props. Same goes with <code>useEffect</code>: allow for synchronize things outside of React tree according to current props &amp; state. This is different from the mental model of <em>mount/update/unmount</em> (which is the journey), would fail to <em>synchronize</em> the results if attempt to write an effect that behaves differently depending on whether the component renders for the first time or not.</p><h3 id="Diff-Effects"><a href="#Diff-Effects" class="headerlink" title="Diff Effects"></a>Diff Effects</h3><p>Running all effects on <em>every</em> render = not efficient (could also lead to infinite loops). Fix by doing the following:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    document.title = <span class="string">&#x27;Hello, &#x27;</span> + name;</span><br><span class="line">  &#125;, [name]); // Our deps</span><br><span class="line"></span><br><span class="line">  const oldEffect = () =&gt; &#123; document.title = <span class="string">&#x27;Hello, Dan&#x27;</span>; &#125;;</span><br><span class="line">const oldDeps = [<span class="string">&#x27;Dan&#x27;</span>];</span><br><span class="line"></span><br><span class="line">const newEffect = () =&gt; &#123; document.title = <span class="string">&#x27;Hello, Dan&#x27;</span>; &#125;;</span><br><span class="line">const newDeps = [<span class="string">&#x27;Dan&#x27;</span>];</span><br><span class="line"></span><br><span class="line">// React can<span class="string">&#x27;t peek inside of functions, but it can compare deps.</span></span><br><span class="line"><span class="string">// Since all deps are the same, it doesn’t need to run the new effect.</span></span><br></pre></td></tr></table></figure><p>Avoid re-running effect by providing dependency array, will check agains this array during every render, and run the effect if one (or more) of values in the array is different from the previous render.</p><h3 id="Dependency-Honesty"><a href="#Dependency-Honesty" class="headerlink" title="Dependency Honesty"></a>Dependency Honesty</h3><ol><li>include <em>all</em> values insdie the component that are used inside the effect.</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  const id = setInterval(() =&gt; &#123;</span><br><span class="line">    setCount(count + 1);</span><br><span class="line">  &#125;, 1000);</span><br><span class="line">  <span class="built_in">return</span> () =&gt; clearInterval(id);</span><br><span class="line">&#125;, [count]);</span><br></pre></td></tr></table></figure><ol start="2"><li>change effect code to reduce dependencies needed.</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  const id = setInterval(() =&gt; &#123;</span><br><span class="line">    setCount(c =&gt; c + 1);</span><br><span class="line">  &#125;, 1000);</span><br><span class="line">  <span class="built_in">return</span> () =&gt; clearInterval(id);</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure><p>For the <code>count</code> example, could remove <code>count</code> from dependency array by using the <a href="https://reactjs.org/docs/hooks-reference.html#functional-updates">functional updater form</a> of <code>setState</code>.</p><h3 id="Decouple-Updates-from-Actions"><a href="#Decouple-Updates-from-Actions" class="headerlink" title="Decouple Updates from Actions"></a>Decouple Updates from Actions</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Counter</span></span>() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line">  const [step, setStep] = useState(1);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const id = setInterval(() =&gt; &#123;</span><br><span class="line">      setCount(c =&gt; c + step);</span><br><span class="line">    &#125;, 1000);</span><br><span class="line">    <span class="built_in">return</span> () =&gt; clearInterval(id);</span><br><span class="line">  &#125;, [step]);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;h1&gt;&#123;count&#125;&lt;/h1&gt;</span><br><span class="line">      &lt;input value=&#123;step&#125; onChange=&#123;e =&gt; setStep(Number(e.target.value))&#125; /&gt;</span><br><span class="line">    &lt;/&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Added another dependency <code>step</code>, if want to avoid effect from calling on changes to <code>step</code>, could use <code>useReducer</code> to remove <code>step</code> from dependency array.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const [state, dispatch] = useReducer(reducer, initialState);</span><br><span class="line">const &#123; count, step &#125; = state;</span><br><span class="line"></span><br><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  const id = setInterval(() =&gt; &#123;</span><br><span class="line">    dispatch(&#123; <span class="built_in">type</span>: <span class="string">&#x27;tick&#x27;</span> &#125;); // Instead of setCount(c =&gt; c + step);</span><br><span class="line">  &#125;, 1000);</span><br><span class="line">  <span class="built_in">return</span> () =&gt; clearInterval(id);</span><br><span class="line">&#125;, [dispatch]);</span><br></pre></td></tr></table></figure><p>React guarantees the dispatch function to be constant throughout the component lifetime.<br><em>(You may omit dispatch, setState, and useRef container values from the deps because React guarantees them to be static. But it also doesn’t hurt to specify them.)</em><br>When setting a state variable depends on the current value of another state variable, replace both with <code>useReducer</code>. Consider <code>useReducer</code> for cases where <code>setSomething(something =&gt; ...)</code> is necessary.<br><code>useReducer</code> allow to decouple expressing the “actions” that happened in your component from how the state updates in response to them (decouple the update logic from describing what happened).</p><h3 id="Functions-in-Effects"><a href="#Functions-in-Effects" class="headerlink" title="Functions in Effects"></a>Functions in Effects</h3><p>Move function directly into effect:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">SearchResults</span></span>() &#123;</span><br><span class="line">  // ...</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    // We moved these <span class="built_in">functions</span> inside!</span><br><span class="line">    <span class="keyword">function</span> <span class="function"><span class="title">getFetchUrl</span></span>() &#123;</span><br><span class="line">      <span class="built_in">return</span> <span class="string">&#x27;https://hn.algolia.com/api/v1/search?query=react&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    async <span class="keyword">function</span> <span class="function"><span class="title">fetchData</span></span>() &#123;</span><br><span class="line">      const result = await axios(getFetchUrl());</span><br><span class="line">      setData(result.data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fetchData();</span><br><span class="line">  &#125;, []); // ✅ Deps are OK</span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>If use any state values inside the function, will need to add that state into the dependency array:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">SearchResults</span></span>() &#123;</span><br><span class="line">  const [query, setQuery] = useState(<span class="string">&#x27;react&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="function"><span class="title">getFetchUrl</span></span>() &#123;</span><br><span class="line">      <span class="built_in">return</span> <span class="string">&#x27;https://hn.algolia.com/api/v1/search?query=&#x27;</span> + query;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    async <span class="keyword">function</span> <span class="function"><span class="title">fetchData</span></span>() &#123;</span><br><span class="line">      const result = await axios(getFetchUrl());</span><br><span class="line">      setData(result.data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fetchData();</span><br><span class="line">  &#125;, [query]); // ✅ Deps are OK</span><br><span class="line"></span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>If functions does not use any values from within the component scope, can hoist the functions to remove them from dependency array:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// ✅ Not affected by the data flow</span><br><span class="line"><span class="keyword">function</span> getFetchUrl(query) &#123;</span><br><span class="line">  <span class="built_in">return</span> <span class="string">&#x27;https://hn.algolia.com/api/v1/search?query=&#x27;</span> + query;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">SearchResults</span></span>() &#123;</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(<span class="string">&#x27;react&#x27;</span>);</span><br><span class="line">    // ... Fetch data and <span class="keyword">do</span> something ...</span><br><span class="line">  &#125;, []); // ✅ Deps are OK</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(<span class="string">&#x27;redux&#x27;</span>);</span><br><span class="line">    // ... Fetch data and <span class="keyword">do</span> something ...</span><br><span class="line">  &#125;, []); // ✅ Deps are OK</span><br><span class="line"></span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Can also use <code>useCallback</code> hook:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">SearchResults</span></span>() &#123;</span><br><span class="line">  // ✅ Preserves identity when its own deps are the same</span><br><span class="line">  const getFetchUrl = useCallback((query) =&gt; &#123;</span><br><span class="line">    <span class="built_in">return</span> <span class="string">&#x27;https://hn.algolia.com/api/v1/search?query=&#x27;</span> + query;</span><br><span class="line">  &#125;, []);  // ✅ Callback deps are OK</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(<span class="string">&#x27;react&#x27;</span>);</span><br><span class="line">    // ... Fetch data and <span class="keyword">do</span> something ...</span><br><span class="line">  &#125;, [getFetchUrl]); // ✅ Effect deps are OK</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(<span class="string">&#x27;redux&#x27;</span>);</span><br><span class="line">    // ... Fetch data and <span class="keyword">do</span> something ...</span><br><span class="line">  &#125;, [getFetchUrl]); // ✅ Effect deps are OK</span><br><span class="line"></span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>useCallback</code> = adding another layer of dependency checks – make the function itself change when necessary (instead of calling effect on every change).</p>]]></content>
      
      
      <categories>
          
          <category> Reading </category>
          
      </categories>
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
